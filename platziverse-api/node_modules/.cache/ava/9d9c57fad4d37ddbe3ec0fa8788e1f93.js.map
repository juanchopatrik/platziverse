{"version":3,"sources":["tests/api-tests.js"],"names":["test","require","request","sinon","proxyquire","agentFixtures","sandbox","server","dbStub","AgentStub","MetricStub","uuid","beforeEach","createSandbox","stub","returns","Promise","resolve","Agent","Metric","findConnected","connected","findByUuid","whithArgs","byUuid","api","afterEach","restore","serial","cb","t","get","expect","end","err","res","falsy","body","JSON","stringify","expected","deepEqual","todo"],"mappings":"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","sourceRoot":"/home/juancho/Documentos/platzi/platziverse/platziverse-api","sourcesContent":["'use strict'\n\nconst test = require('ava')\nconst request = require('supertest')\nconst sinon = require('sinon')\nconst proxyquire = require('proxyquire')\n\nconst agentFixtures = require('./fixtures/agent')\n\nlet sandbox = null\nlet server = null\nlet dbStub = null\nlet AgentStub = {}\nlet MetricStub = {}\n\nconst uuid = 'yyy-yyy-yyy'\n\ntest.beforeEach(async () => {\n  sandbox = sinon.createSandbox()\n\n  dbStub = sandbox.stub()\n  dbStub.returns(Promise.resolve({\n    Agent: AgentStub,\n    Metric: MetricStub\n  }))\n\n  AgentStub.findConnected = sandbox.stub()\n  AgentStub.findConnected.returns(Promise.resolve(agentFixtures.connected))\n\n  AgentStub.findByUuid = sandbox.stub()\n  AgentStub.findByUuid.whithArgs(uuid).returns(Promise.resolve(agentFixtures.byUuid))\n\n\n  const api = proxyquire('../api', {\n    'platziverse-db': dbStub\n  })\n\n  server = proxyquire('../server', {\n    './api': api\n  })\n})\n\ntest.afterEach(() => {\n  sandbox && sinon.restore()\n})\n\ntest.serial.cb('/api/agents', t => {\n  request(server)\n    .get('/api/agents')\n    .expect(200)\n    .expect('Content-Type', /json/)\n    .end((err, res) => {\n      t.falsy(err, 'should not return an error')\n      let body = JSON.stringify(res.body)\n      let expected = JSON.stringify(agentFixtures.connected)\n      t.deepEqual(body, expected, 'response body should be the expected')\n      t.end()\n    })\n})\n\n\n\ntest.serial.cb('/api/agents/:uuid', t => {\n    request(server)\n      .get(`/api/agents/${uuid}`)\n      .expect(200)\n      .expect('Content-Type', /json/)\n      .end((err, res) => {\n        t.falsy(err, 'should not return an error')\n        let body = JSON.stringify(res.body)\n        let expected = JSON.stringify(agentFixtures.byUuid)\n        t.deepEqual(body, expected, 'response body should be the expected')\n        t.end()\n      })\n  })\ntest.serial.todo('/api/agent/:uuid - not found')\n\ntest.serial.todo('/api/metrics/:uuid')\ntest.serial.todo('/api/metrics/:uuid - not found')\n\ntest.serial.todo('/api/metrics/:uuid/:type')\ntest.serial.todo('/api/metrics/:uuid/:type - not found')"]}