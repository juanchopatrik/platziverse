{"version":3,"sources":["tests/api-tests.js"],"names":["test","require","request","sinon","proxyquire","agentFixtures","sandbox","server","dbStub","AgentStub","MetricStub","uuid","uuidArgs","where","beforeEach","createSandbox","stub","returns","Promise","resolve","Agent","Metric","findConnected","connected","findOne","withArgs","byUuid","api","afterEach","restore","serial","cb","t","get","expect","end","err","res","falsy","body","JSON","stringify","expected","deepEqual","todo"],"mappings":"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","sourceRoot":"/home/juancho/Documentos/platzi/platziverse/platziverse-api","sourcesContent":["'use strict'\n\nconst test = require('ava')\nconst request = require('supertest')\nconst sinon = require('sinon')\nconst proxyquire = require('proxyquire')\n\nconst agentFixtures = require('./fixtures/agent')\n\nlet sandbox = null\nlet server = null\nlet dbStub = null\nlet AgentStub = {}\nlet MetricStub = {}\nlet uuid = 'yyy-yyy-yyy'\n\nlet uuidArgs = {\n    where : {uuid}\n  }\n\ntest.beforeEach(async () => {\n  sandbox = sinon.createSandbox()\n\n  dbStub = sandbox.stub()\n  dbStub.returns(Promise.resolve({\n    Agent: AgentStub,\n    Metric: MetricStub,\n  }))\n\n  AgentStub.findConnected = sandbox.stub()\n  AgentStub.findConnected.returns(Promise.resolve(agentFixtures.connected))\n\n  AgentStub.findOne= sandbox.stub()\n  AgentStub.findOne.withArgs(uuid).returns(Promise.resolve(agentFixtures.byUuid(uuid)))\n\n\n  const api = proxyquire('../api', {\n    'platziverse-db': dbStub\n  })\n\n  server = proxyquire('../server', {\n    './api': api\n  })\n})\n\ntest.afterEach(() => {\n  sandbox && sinon.restore()\n})\n\ntest.serial.cb('/api/agents', t => {\n  request(server)\n    .get('/api/agents')\n    .expect(200)\n    .expect('Content-Type', /json/)\n    .end((err, res) => {\n      t.falsy(err, 'should not return an error')\n      let body = JSON.stringify(res.body)\n      let expected = JSON.stringify(agentFixtures.connected)\n      t.deepEqual(body, expected, 'response body should be the expected')\n      t.end()\n    })\n})\n\n\n\ntest.serial.cb('/api/agents/:uuid', t => {\n    request(server)\n      .get(`/api/agents/${uuidArgs}`)\n      .expect(200)\n      .expect('Content-Type', /json/)\n      .end((err, res) => {\n        t.falsy(err, 'should not return an error')\n        let body = JSON.stringify(res.body)\n        let expected = JSON.stringify(agentFixtures.byUuid(uuid))\n        t.deepEqual(body, expected, 'response body should be the expected')\n        t.end()\n      })\n  })\ntest.serial.todo('/api/agent/:uuid - not found')\n\ntest.serial.todo('/api/metrics/:uuid')\ntest.serial.todo('/api/metrics/:uuid - not found')\n\ntest.serial.todo('/api/metrics/:uuid/:type')\ntest.serial.todo('/api/metrics/:uuid/:type - not found')"]}